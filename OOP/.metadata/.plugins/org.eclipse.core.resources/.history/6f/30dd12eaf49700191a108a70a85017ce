package com.techlab.game;

import com.techlab.Exception.AllReadyMarkCellException;
import com.techlab.board.Board;
import com.techlab.board.Cell;
import com.techlab.board.Mark;
import com.techlab.player.Player;
import com.techlab.result.analyze.Result;
import com.techlab.result.analyze.ResultAnalyze;

public class Game {
	private Player player1;
	private Player player2;
	private Board board;
	private ResultAnalyze resultAnalyze;
	private Mark playerSign;
	private Cell[] boardCells;
	private int GO_TO_NEXT_ROW = 3;
	private int GO_TO_NEXT_COLUMN = 1;

	public Game(Player player1, Player player2) {
		this.player1 = player1;
		this.player2 = player2;
	}

	public void startGame() {
		board = new Board();
		resultAnalyze = new ResultAnalyze(board);
		playerSign = player1.getMark();
	}

	public void setMarkInCellOfBoard(int position) throws AllReadyMarkCellException {

		board.setBoardCellMark(position, playerSign);
		playerSign = changePlayerSign();
		displayBoard();
	}

	private Mark changePlayerSign() {
		if (playerSign.equals(Mark.X))
			return Mark.O;
		if (playerSign.equals(Mark.O))
			return Mark.X;
		return null;
	}

	public String getResult() {

		Result result = resultAnalyze.genrateResultState();
		if (result.equals(Result.WIN)) {
			System.out.println(resultAnalyze.getWiningPlayerSign());
			return checkWhoPlayerIsWin();
		}
		return result.toString();
	}

	private String checkWhoPlayerIsWin() {
		if (player1.getMark().equals(resultAnalyze.getWiningPlayerSign())) {
			return player1.getName() + " is Win";
		}
		return player2.getName() + " is Win";
	}

	public void displayBoard() {
		boardCells = board.getBoardState();

		for (int index = 0; index < boardCells.length; index = index + GO_TO_NEXT_ROW) {
			System.out.println(" " + boardCells[index].getCellState() + " | "
					+ boardCells[index + GO_TO_NEXT_COLUMN].getCellState() + " | "
					+ boardCells[index + GO_TO_NEXT_COLUMN + GO_TO_NEXT_COLUMN].getCellState());
			System.out.println("-----------");
		}
	}
}
